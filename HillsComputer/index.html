<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>電腦入侵中……</title>
<style>
html,body{
  margin:0;
  height:100%;
  overflow:hidden;
  background:url('/monitor0314/images/XP.jpg') no-repeat center/cover;
  font-family:system-ui;
}
.desktop{
  height:100%;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:16px;
  align-items:flex-start;
}
.icon{
  width:80px;
  display:flex;
  flex-direction:column;
  align-items:center;
  cursor:pointer;
  color:white;
  font-size:14px;
  text-align:center;
  text-shadow:0 2px 4px black;
  user-select:none;
}
.icon img{
  width:48px;
  height:48px;
  margin-bottom:6px;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:flex;
  justify-content:center;
  align-items:center;
  opacity:0;
  pointer-events:none;
  transition:.3s;
  z-index:999;
}
.modal.active{
  opacity:1;
  pointer-events:auto;
}
.modal-content{
  background:#1e1e1e;
  color:white;
  padding:20px;
  border-radius:12px;
  max-width:90vw;
  max-height:90vh;
  position:relative;
}
.close-btn{
  position:absolute;
  top:8px;
  right:12px;
  background:#ff4c4c;
  border:none;
  color:white;
  padding:4px 10px;
  border-radius:6px;
  cursor:pointer;
}
.pwd-box{
  width:48px;
  height:48px;
  font-size:24px;
  text-align:center;
}
.folder-window{
  display:none;
  position:fixed;
  top:50px; left:50px;
  width:600px; height:400px;
  background:#c0d6f7;
  border:1px solid #000;
  box-shadow:2px 2px 10px rgba(0,0,0,0.5);
  z-index:1;
}
.folder-titlebar{
  background:#0a64ad; color:white;
  display:flex; justify-content:space-between; align-items:center;
  padding:2px 6px;
  cursor:move;
}
.folder-content{
  padding:10px;
  display:flex; flex-wrap:wrap; gap:12px;
  overflow:auto; height:calc(100% - 28px);
}
.folder-icon{
  width:80px; text-align:center; cursor:pointer;
}
.folder-icon img{
  width:48px; height:48px; margin-bottom:6px;
}
</style>
</head>
<body>

<div class="desktop">
  <div class="icon" data-type="image" data-src="/monitor0314/images/PC.png">
    <img src="/monitor0314/icons/Desktop.png">我的電腦
  </div>

  <div class="icon" id="trash">
    <img src="/monitor0314/icons/Trash.png">資源回收桶
  </div>

  <div class="icon" data-type="gallery"
    data-images='[
      "/monitor0314/images/Calendar01.jpg",
      "/monitor0314/images/Calendar02.jpg",
      "/monitor0314/images/Calendar03.jpg",
      "/monitor0314/images/Calendar04.jpg",
      "/monitor0314/images/Calendar05.jpg",
      "/monitor0314/images/Calendar06.jpg",
      "/monitor0314/images/Calendar07.jpg",
      "/monitor0314/images/Calendar08.jpg",
      "/monitor0314/images/Calendar09.jpg",
      "/monitor0314/images/Calendar10.jpg",
      "/monitor0314/images/Calendar11.jpg",
      "/monitor0314/images/Calendar12.jpg"
    ]'>
    <img src="/monitor0314/icons/Calendar.png">日曆
  </div>

  <div class="icon" data-type="folder" id="genericFolder">
    <img src="/monitor0314/icons/File.png">資料夾
  </div>

  <div class="icon" data-type="url" data-src="https://www.google.com/">
    <img src="/monitor0314/icons/google.png">GOOGOO
  </div>

  <div class="icon"
       id="accountBook"
       draggable="true"
       data-type="pdf"
       data-password="0519"
       data-src="/monitor0314/another/ledger.pdf">
    <img src="/monitor0314/icons/Notepad.png">帳本
  </div>

  <div class="icon" data-type="image" data-src="/monitor0314/images/family.jpg">
    <img src="/monitor0314/icons/photo.png">瑪莉亞與喬登
  </div>

  <div class="icon" data-type="folder" id="monitorFolder">
    <img src="/monitor0314/icons/monitor.png">監視器
  </div>
</div>

<!-- 共用彈窗 -->
<div class="modal" id="modal">
  <div class="modal-content">
    <button class="close-btn" id="closeBtn">X</button>
    <div id="modalBody"></div>
  </div>
</div>

<!-- 資料夾視窗 -->
<div class="folder-window" id="folderWindow">
  <div class="folder-titlebar">
    <span id="folderTitle">資料夾</span>
    <button class="close-btn" id="folderCloseBtn">X</button>
  </div>
  <div class="folder-content" id="folderContent"></div>
</div>

<script>
const modal=document.getElementById('modal');
const modalBody=document.getElementById('modalBody');
document.getElementById('closeBtn').onclick=()=>{modal.classList.remove('active');modalBody.innerHTML='';};

/* ===== 全部圖片預加載 ===== */
document.querySelectorAll('.icon img').forEach(img=>{new Image().src=img.src;});
document.querySelectorAll('.icon[data-type="gallery"]').forEach(icon=>{
  JSON.parse(icon.dataset.images).forEach(src=>new Image().src=src);
});

/* ===== 一般 icon 點擊 ===== */
document.querySelectorAll('.desktop .icon').forEach(icon=>{
  icon.addEventListener('click',()=>{
    const type=icon.dataset.type, src=icon.dataset.src, pwd=icon.dataset.password;
    if(!type) return;

    // 資料夾
    if(type==='folder' && (icon.id==='genericFolder')){
      const folderWin=document.getElementById('folderWindow');
      const folderContent=document.getElementById('folderContent');
      document.getElementById('folderTitle').innerText=icon.innerText;
      folderContent.innerHTML=`<div class="folder-icon"><img src="/monitor0314/images/PC.png"><div>示例圖片</div></div>`; // 可自訂內容
      folderWin.style.display='block';

      folderContent.querySelectorAll('.folder-icon').forEach(fi=>{
        fi.onclick=()=>{
          modalBody.innerHTML=`<img src="${fi.querySelector('img').src}" style="max-width:90vw;max-height:90vh;">`;
          modal.classList.add('active');
        };
      });
      return;
    }

    // URL
    if(type==='url'){window.open(src,'_blank'); return;}
    // Text
    if(type==='text'){modalBody.innerHTML=`<p>${src}</p>`; modal.classList.add('active'); return;}
    // Image
    if(type==='image'){modalBody.innerHTML=`<img src="${src}" style="max-width:90vw;max-height:90vh;">`; modal.classList.add('active'); return;}
    // Gallery
    if(type==='gallery'){
      const images=JSON.parse(icon.dataset.images); let i=0;
      const render=()=>{modalBody.innerHTML=`
        <button id="p">◀</button>
        <img src="${images[i]}" style="max-width:80vw;max-height:80vh;">
        <button id="n">▶</button>
        <p>${i+1}/${images.length}</p>`;
        document.getElementById('p').onclick=()=>{i=(i-1+images.length)%images.length; render();}
        document.getElementById('n').onclick=()=>{i=(i+1)%images.length; render();}
      };
      render(); modal.classList.add('active'); return;
    }
    // PDF 帳本
    if(type==='pdf'){
      modalBody.innerHTML=`<p>請輸入密碼</p>
        <div style="display:flex;gap:8px;">${'<input class="pwd-box" maxlength="1">'.repeat(4)}</div>
        <p id="err" style="color:red;display:none;">密碼錯誤</p>
        <button id="pwdConfirm" style="margin-top:10px;">確定</button>`;
      modal.classList.add('active');

      const ins=[...document.querySelectorAll('.pwd-box')]; ins[0].focus();

      function checkPwd(){
        if(ins.map(i=>i.value).join('')===pwd){
          modalBody.innerHTML=`<iframe src="${src}" style="width:90vw;height:80vh;"></iframe>`;
        } else {
          document.getElementById('err').style.display='block';
          ins.forEach(i=>i.value=''); ins[0].focus();
        }
      }

      document.getElementById('pwdConfirm').onclick=checkPwd;

      ins.forEach((input,i)=>{
        input.addEventListener('input',()=>{
          if(input.value.length===1 && i<ins.length-1) ins[i+1].focus();
        });
        input.addEventListener('keydown',e=>{
          if(e.key==='Backspace' && input.value==='') {if(i>0) ins[i-1].focus();}
          if(e.key==='Enter') checkPwd();
        });
      });
    }
  });
});

/* ===== 監視器資料夾 ===== */
const monitorFolder=document.getElementById('monitorFolder');
const folderWin=document.getElementById('folderWindow');
const folderContent=document.getElementById('folderContent');

const videos=[
  '/monitor0314/videos/video1.mp4',
  '/monitor0314/videos/video2.mp4',
  '/monitor0314/videos/video3.mp4',
  '/monitor0314/videos/video4.mp4'
];

monitorFolder.addEventListener('click',()=>{
  document.getElementById('folderTitle').innerText='監視器';
  folderContent.innerHTML=videos.map((v,i)=>`
    <div class="folder-icon" data-video="${v}">
      <img src="/monitor0314/icons/monitor.png">
      <div>監視器 ${i+1}</div>
    </div>`).join('');
  folderWin.style.display='block';

  folderContent.querySelectorAll('.folder-icon').forEach(icon=>{
    icon.onclick=()=>{
      modalBody.innerHTML=`<video src="${icon.dataset.video}" controls autoplay style="max-width:100%;max-height:100%;"></video>`;
      modal.classList.add('active');
    };
  });
});

document.getElementById('folderCloseBtn').addEventListener('click',()=>{folderWin.style.display='none';});

/* ===== 資源回收桶拖曳 ===== */
const book=document.getElementById('accountBook');
const trash=document.getElementById('trash');
book.addEventListener('dragstart',e=>e.dataTransfer.setData('x','book'));
trash.addEventListener('dragover',e=>e.preventDefault());
trash.addEventListener('drop',e=>{
  if(e.dataTransfer.getData('x')==='book') book.remove();
});

/* ===== 資料夾可拖曳 ===== */
let drag=false,offsetX,offsetY;
const titleBar=folderWin.querySelector('.folder-titlebar');
titleBar.onmousedown=e=>{drag=true; offsetX=e.clientX-folderWin.offsetLeft; offsetY=e.clientY-folderWin.offsetTop;}
document.onmousemove=e=>{if(drag){folderWin.style.left=(e.clientX-offsetX)+'px'; folderWin.style.top=(e.clientY-offsetY)+'px';}}
document.onmouseup=()=>{drag=false;}
</script>

</body>
</html>
